
{% extends "base.html" %}
{% block content %}
<div class="top-nav">
    <a href="/" class="btn btn-outline-primary">Generate New Draft</a>
</div>

<form method="post" action="/approve/{{ draft_id }}" class="card shadow-sm p-4">
    <div class="mb-3">
        <label class="form-label">Episode title (editable)</label>
        <input class="form-control" name="title" value="{{ title }}" required />
    </div>
    <div class="mb-3">
        <label class="form-label">Script</label>
        <textarea class="form-control" name="script" rows="18" required>{{ script }}</textarea>
    </div>
    <div class="primary-actions d-flex gap-2">
        {% if request.args.get('mp3_ready') %}
            <a href="/audio/{{ draft['mp3_filename'] }}" download class="btn btn-info btn-lg">Download MP3</a>
            <button formaction="/upload/{{ draft_id }}" formmethod="post" class="btn btn-success btn-lg" onclick="this.disabled=true; this.innerHTML='Publishing...'; this.form.submit();">Upload to Transistor</button>
        {% else %}
            <button formaction="/generate_mp3/{{ draft_id }}" formmethod="post" class="btn btn-primary btn-lg" onclick="this.disabled=true; this.innerHTML='Generating MP3...'; this.form.submit();">Generate MP3</button>
            <button formaction="/generate_and_upload/{{ draft_id }}" formmethod="post" class="btn btn-success btn-lg" onclick="this.disabled=true; this.innerHTML='Generating & Uploading...'; this.form.submit();">Generate & Upload</button>
        {% endif %}
    </div>
    <div class="mt-4">
        <label class="form-label">Feedback for regeneration</label>
        <textarea class="form-control" name="feedback" rows="3" placeholder="Enter feedback to guide script regeneration..."></textarea>
        <button formaction="/revise/{{ draft_id }}" formmethod="post" class="btn btn-warning btn-lg mt-3" onclick="this.disabled=true; this.innerHTML='Regenerating...'; this.form.submit();">Regenerate Script</button>
    </div>
</form>
{% endblock %}
